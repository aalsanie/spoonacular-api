spring:
  application:
    name: atypon-food-api
  jackson:
    deserialization:
      fail-on-unknown-properties: true


management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      probes:
        enabled: true
  metrics:
    tags:
      application: ${spring.application.name}

spoonacular:
  base-url: https://api.spoonacular.com
  api-key: ${API_KEY:}

  health:
    # If enabled, performs a real outbound call for health.
    live-check-enabled: false
    cache-ttl: 60s

http:
  client:
    connect-timeout: 2s
    read-timeout: 4s

idempotency:
  enabled: true
  header: Idempotency-Key
  ttl: 30m
  max-entries: 5000
  in-flight-wait: 0ms  # 0 = do not wait; return 409 on concurrent duplicate

rate-limits:
  inbound:
    enabled: true
    # per-client (IP) limits.
    limit-for-period: 120
    refresh-period: 60s
    timeout: 0ms
    max-clients: 10000

alerting:
  enabled: true
  throttle: 60s

resilience4j:
  retry:
    instances:
      spoonacular:
        max-attempts: 4
        wait-duration: 200ms
        enable-exponential-backoff: true
        exponential-backoff-multiplier: 2.0
        enable-randomized-wait: true
        randomized-wait-factor: 0.25
        retry-exceptions:
          - org.springframework.web.client.HttpServerErrorException
          - org.springframework.web.client.ResourceAccessException
          - org.springframework.web.client.HttpClientErrorException$TooManyRequests
  ratelimiter:
    instances:
      spoonacular:
        limit-for-period: 10
        limit-refresh-period: 1s
        timeout-duration: 0ms

## Documentation
springdoc:
  swagger-ui:
    path: /swagger-ui.html  # Default Swagger UI path

## for testing purposes
logging:
  level:
    org:
      springframework:
        web:
          client:
            RestTemplate: DEBUG

server:
  port: 8091
